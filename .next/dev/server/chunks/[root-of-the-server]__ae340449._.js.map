{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/murakamimaxi/Desktop/%E3%82%B3%E3%83%BC%E3%83%88%E3%82%99/sns_analyst/lib/instagram.ts"],"sourcesContent":["import { cache } from 'react';\n\nconst ACCESS_TOKEN = process.env.INSTAGRAM_ACCESS_TOKEN;\nconst USER_ID = process.env.INSTAGRAM_USER_ID;\nconst API_VERSION = 'v19.0';\nconst BASE_URL = `https://graph.facebook.com/${API_VERSION}`;\n\nexport interface InstagramMedia {\n  id: string;\n  caption: string;\n  media_type: string;\n  permalink: string;\n  timestamp: string;\n  like_count: number;\n  comments_count: number;\n  media_url?: string;\n  thumbnail_url?: string;\n  insights?: {\n    views: number;\n    reach: number;\n    saved: number;\n  };\n}\n\nexport const getInstagramPosts = async (): Promise<InstagramMedia[]> => {\n  if (!ACCESS_TOKEN || !USER_ID) {\n    console.error('❌ API Key missing');\n    return [];\n  }\n\n  const fields =\n    'id,caption,media_type,timestamp,like_count,comments_count,permalink';\n  const url = `${BASE_URL}/${USER_ID}/media?fields=${fields}&access_token=${ACCESS_TOKEN}&limit=20`;\n\n  console.log('Fetching URL:', url);\n\n  try {\n    const res = await fetch(url, { cache: 'no-store' });\n\n    if (!res.ok) {\n      const errorData = await res.json();\n      console.error('❌ Instagram API Error:', errorData);\n      return [];\n    }\n\n    const data = await res.json();\n    console.log('✅ Posts fetched:', data.data?.length || 0);\n    return data.data || [];\n  } catch (error) {\n    console.error('❌ Fetch Error:', error);\n    return [];\n  }\n};\n\nexport async function getMediaInsights(mediaId: string) {\n  if (!ACCESS_TOKEN) return null;\n\n  const metrics = 'views,reach,saved';\n  const url = `${BASE_URL}/${mediaId}/insights?metric=${metrics}&access_token=${ACCESS_TOKEN}`;\n\n  try {\n    const res = await fetch(url, { cache: 'no-store' });\n    if (!res.ok) return null;\n\n    const json = await res.json();\n    const data = json.data;\n\n    const results: Record<string, number> = {};\n    if (Array.isArray(data)) {\n      for (const item of data) {\n        if (item.values && item.values.length > 0) {\n          results[item.name] = item.values[0].value;\n        }\n      }\n    }\n\n    return {\n      views: results['views'] || 0,\n      reach: results['reach'] || 0,\n      saved: results['saved'] || 0,\n    };\n  } catch (error) {\n    return null;\n  }\n}\n\nexport const getPostWithInsights = async (\n  mediaId: string,\n): Promise<InstagramMedia | null> => {\n  if (!ACCESS_TOKEN) return null;\n\n  const fields =\n    'id,caption,media_type,timestamp,like_count,comments_count,permalink';\n  const url = `${BASE_URL}/${mediaId}?fields=${fields}&access_token=${ACCESS_TOKEN}`;\n\n  try {\n    const res = await fetch(url, { cache: 'no-store' });\n    if (!res.ok) return null;\n\n    const post = await res.json();\n    const insights = await getMediaInsights(mediaId);\n\n    return {\n      ...post,\n      insights: insights || { views: 0, reach: 0, saved: 0 },\n    };\n  } catch (error) {\n    return null;\n  }\n};\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAM,eAAe,QAAQ,GAAG,CAAC,sBAAsB;AACvD,MAAM,UAAU,QAAQ,GAAG,CAAC,iBAAiB;AAC7C,MAAM,cAAc;AACpB,MAAM,WAAW,CAAC,2BAA2B,EAAE,aAAa;AAmBrD,MAAM,oBAAoB;IAC/B,IAAI,CAAC,gBAAgB,CAAC,SAAS;QAC7B,QAAQ,KAAK,CAAC;QACd,OAAO,EAAE;IACX;IAEA,MAAM,SACJ;IACF,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,QAAQ,cAAc,EAAE,OAAO,cAAc,EAAE,aAAa,SAAS,CAAC;IAEjG,QAAQ,GAAG,CAAC,iBAAiB;IAE7B,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,KAAK;YAAE,OAAO;QAAW;QAEjD,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,YAAY,MAAM,IAAI,IAAI;YAChC,QAAQ,KAAK,CAAC,0BAA0B;YACxC,OAAO,EAAE;QACX;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,QAAQ,GAAG,CAAC,oBAAoB,KAAK,IAAI,EAAE,UAAU;QACrD,OAAO,KAAK,IAAI,IAAI,EAAE;IACxB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO,EAAE;IACX;AACF;AAEO,eAAe,iBAAiB,OAAe;IACpD,IAAI,CAAC,cAAc,OAAO;IAE1B,MAAM,UAAU;IAChB,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,QAAQ,iBAAiB,EAAE,QAAQ,cAAc,EAAE,cAAc;IAE5F,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,KAAK;YAAE,OAAO;QAAW;QACjD,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;QAEpB,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,OAAO,KAAK,IAAI;QAEtB,MAAM,UAAkC,CAAC;QACzC,IAAI,MAAM,OAAO,CAAC,OAAO;YACvB,KAAK,MAAM,QAAQ,KAAM;gBACvB,IAAI,KAAK,MAAM,IAAI,KAAK,MAAM,CAAC,MAAM,GAAG,GAAG;oBACzC,OAAO,CAAC,KAAK,IAAI,CAAC,GAAG,KAAK,MAAM,CAAC,EAAE,CAAC,KAAK;gBAC3C;YACF;QACF;QAEA,OAAO;YACL,OAAO,OAAO,CAAC,QAAQ,IAAI;YAC3B,OAAO,OAAO,CAAC,QAAQ,IAAI;YAC3B,OAAO,OAAO,CAAC,QAAQ,IAAI;QAC7B;IACF,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,MAAM,sBAAsB,OACjC;IAEA,IAAI,CAAC,cAAc,OAAO;IAE1B,MAAM,SACJ;IACF,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,QAAQ,QAAQ,EAAE,OAAO,cAAc,EAAE,cAAc;IAElF,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,KAAK;YAAE,OAAO;QAAW;QACjD,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;QAEpB,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,WAAW,MAAM,iBAAiB;QAExC,OAAO;YACL,GAAG,IAAI;YACP,UAAU,YAAY;gBAAE,OAAO;gBAAG,OAAO;gBAAG,OAAO;YAAE;QACvD;IACF,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF"}},
    {"offset": {"line": 138, "column": 0}, "map": {"version":3,"sources":["file:///Users/murakamimaxi/Desktop/%E3%82%B3%E3%83%BC%E3%83%88%E3%82%99/sns_analyst/app/api/instagram/fetch-posts/route.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from 'next/server';\n\nimport {\n  getInstagramPosts,\n  getPostWithInsights,\n} from '@/lib/instagram';\n\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n  const mediaId = searchParams.get('media_id');\n\n  try {\n    if (mediaId) {\n      const post = await getPostWithInsights(mediaId);\n\n      if (!post) {\n        return NextResponse.json(\n          { error: 'Post not found or API error' },\n          { status: 404 },\n        );\n      }\n      return NextResponse.json(post);\n    }\n\n    const posts = await getInstagramPosts();\n    return NextResponse.json(posts);\n  } catch (error) {\n    console.error('API Route Error:', error);\n    return NextResponse.json(\n      { error: 'Internal Server Error' },\n      { status: 500 },\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;AAKO,eAAe,IAAI,OAAoB;IAC5C,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,UAAU,aAAa,GAAG,CAAC;IAEjC,IAAI;QACF,IAAI,SAAS;YACX,MAAM,OAAO,MAAM,IAAA,yIAAmB,EAAC;YAEvC,IAAI,CAAC,MAAM;gBACT,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,OAAO;gBAA8B,GACvC;oBAAE,QAAQ;gBAAI;YAElB;YACA,OAAO,gJAAY,CAAC,IAAI,CAAC;QAC3B;QAEA,MAAM,QAAQ,MAAM,IAAA,uIAAiB;QACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}