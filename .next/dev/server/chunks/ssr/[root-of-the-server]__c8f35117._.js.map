{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///Users/murakamimaxi/Desktop/%E3%82%B3%E3%83%BC%E3%83%88%E3%82%99/sns_analyst/components/analysis/tag-performance-chart.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const TagPerformanceChart = registerClientReference(\n    function() { throw new Error(\"Attempted to call TagPerformanceChart() from the server but TagPerformanceChart is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/analysis/tag-performance-chart.tsx <module evaluation>\",\n    \"TagPerformanceChart\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,sBAAsB,IAAA,wQAAuB,EACtD;IAAa,MAAM,IAAI,MAAM;AAAsP,GACnR,+EACA","ignoreList":[0]}},
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/murakamimaxi/Desktop/%E3%82%B3%E3%83%BC%E3%83%88%E3%82%99/sns_analyst/components/analysis/tag-performance-chart.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const TagPerformanceChart = registerClientReference(\n    function() { throw new Error(\"Attempted to call TagPerformanceChart() from the server but TagPerformanceChart is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/analysis/tag-performance-chart.tsx\",\n    \"TagPerformanceChart\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,sBAAsB,IAAA,wQAAuB,EACtD;IAAa,MAAM,IAAI,MAAM;AAAsP,GACnR,2DACA","ignoreList":[0]}},
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 50, "column": 0}, "map": {"version":3,"sources":["file:///Users/murakamimaxi/Desktop/%E3%82%B3%E3%83%BC%E3%83%88%E3%82%99/sns_analyst/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,sKAAO,EAAC,IAAA,6IAAI,EAAC;AACtB"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///Users/murakamimaxi/Desktop/%E3%82%B3%E3%83%BC%E3%83%88%E3%82%99/sns_analyst/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,IAAA,uKAAG,EACvB,0KACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SAAS;QACX;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAOF,SAAS,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAmB;IACzD,qBACE,8OAAC;QAAI,WAAW,IAAA,kHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QAAa,GAAG,KAAK;;;;;;AAExE"}},
    {"offset": {"line": 107, "column": 0}, "map": {"version":3,"sources":["file:///Users/murakamimaxi/Desktop/%E3%82%B3%E3%83%BC%E3%83%88%E3%82%99/sns_analyst/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,iBAAiB,IAAA,uKAAG,EACxB,4VACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OAAO;YACP,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AASF,MAAM,uBAAS,mNAAgB,CAC7B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACxD,MAAM,OAAO,UAAU,wKAAI,GAAG;IAC9B,qBACE,8OAAC;QACC,WAAW,IAAA,kHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 167, "column": 0}, "map": {"version":3,"sources":["file:///Users/murakamimaxi/Desktop/%E3%82%B3%E3%83%BC%E3%83%88%E3%82%99/sns_analyst/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,qBAAO,mNAAgB,CAG3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,kHAAE,EACX,4DACA;QAED,GAAG,KAAK;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,mNAAgB,CAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,kHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,mNAAgB,CAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,kHAAE,EACX,sDACA;QAED,GAAG,KAAK;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,mNAAgB,CAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,kHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,mNAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QAAI,KAAK;QAAK,WAAW,IAAA,kHAAE,EAAC,YAAY;QAAa,GAAG,KAAK;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,mNAAgB,CAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,kHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG"}},
    {"offset": {"line": 252, "column": 0}, "map": {"version":3,"sources":["file:///Users/murakamimaxi/Desktop/%E3%82%B3%E3%83%BC%E3%83%88%E3%82%99/sns_analyst/utils/supabase/config.ts"],"sourcesContent":["import {\n  createClient,\n  type SupabaseClient,\n  type SupabaseClientOptions,\n} from '@supabase/supabase-js';\n\nimport type { Database } from '../../types/database';\n\ntype ClientOptions = SupabaseClientOptions<Database>;\n\nconst getEnvValue = (key: string): string => {\n  const value = process.env[key];\n  if (!value) {\n    throw new Error(`Missing required environment variable: ${key}`);\n  }\n\n  return value;\n};\n\nexport const getSupabaseUrl = (): string =>\n  getEnvValue('NEXT_PUBLIC_SUPABASE_URL');\n\nexport const getSupabaseAnonKey = (): string =>\n  getEnvValue('NEXT_PUBLIC_SUPABASE_ANON_KEY');\n\nexport const getSupabaseServiceRoleKey = (): string =>\n  getEnvValue('SUPABASE_SERVICE_ROLE_KEY');\n\nconst baseOptions: ClientOptions = {\n  auth: {\n    autoRefreshToken: true,\n    persistSession: true,\n    detectSessionInUrl: true,\n  },\n  global: {\n    headers: {\n      'X-Client-Info': 'sns-analyst',\n    },\n  },\n};\n\nexport const createSupabaseClientWithConfig = (\n  key: string,\n  options?: ClientOptions,\n): SupabaseClient<Database> =>\n  createClient<Database>(\n    getSupabaseUrl(),\n    key,\n    mergeClientOptions(baseOptions, options),\n  );\n\nconst mergeClientOptions = (\n  base: ClientOptions,\n  overrides?: ClientOptions,\n): ClientOptions => {\n  const clonedBase: ClientOptions = {\n    ...base,\n    auth: base.auth ? { ...base.auth } : undefined,\n    global: base.global\n      ? {\n          ...base.global,\n          headers: base.global.headers\n            ? { ...base.global.headers }\n            : undefined,\n        }\n      : undefined,\n  };\n\n  if (!overrides) {\n    return clonedBase;\n  }\n\n  return {\n    ...clonedBase,\n    ...overrides,\n    auth: {\n      ...(clonedBase.auth ?? {}),\n      ...(overrides.auth ?? {}),\n    },\n    global: {\n      ...(clonedBase.global ?? {}),\n      ...(overrides.global ?? {}),\n      headers: {\n        ...(clonedBase.global?.headers ?? {}),\n        ...(overrides.global?.headers ?? {}),\n      },\n    },\n  };\n};\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAUA,MAAM,cAAc,CAAC;IACnB,MAAM,QAAQ,QAAQ,GAAG,CAAC,IAAI;IAC9B,IAAI,CAAC,OAAO;QACV,MAAM,IAAI,MAAM,CAAC,uCAAuC,EAAE,KAAK;IACjE;IAEA,OAAO;AACT;AAEO,MAAM,iBAAiB,IAC5B,YAAY;AAEP,MAAM,qBAAqB,IAChC,YAAY;AAEP,MAAM,4BAA4B,IACvC,YAAY;AAEd,MAAM,cAA6B;IACjC,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;QAChB,oBAAoB;IACtB;IACA,QAAQ;QACN,SAAS;YACP,iBAAiB;QACnB;IACF;AACF;AAEO,MAAM,iCAAiC,CAC5C,KACA,UAEA,IAAA,uLAAY,EACV,kBACA,KACA,mBAAmB,aAAa;AAGpC,MAAM,qBAAqB,CACzB,MACA;IAEA,MAAM,aAA4B;QAChC,GAAG,IAAI;QACP,MAAM,KAAK,IAAI,GAAG;YAAE,GAAG,KAAK,IAAI;QAAC,IAAI;QACrC,QAAQ,KAAK,MAAM,GACf;YACE,GAAG,KAAK,MAAM;YACd,SAAS,KAAK,MAAM,CAAC,OAAO,GACxB;gBAAE,GAAG,KAAK,MAAM,CAAC,OAAO;YAAC,IACzB;QACN,IACA;IACN;IAEA,IAAI,CAAC,WAAW;QACd,OAAO;IACT;IAEA,OAAO;QACL,GAAG,UAAU;QACb,GAAG,SAAS;QACZ,MAAM;YACJ,GAAI,WAAW,IAAI,IAAI,CAAC,CAAC;YACzB,GAAI,UAAU,IAAI,IAAI,CAAC,CAAC;QAC1B;QACA,QAAQ;YACN,GAAI,WAAW,MAAM,IAAI,CAAC,CAAC;YAC3B,GAAI,UAAU,MAAM,IAAI,CAAC,CAAC;YAC1B,SAAS;gBACP,GAAI,WAAW,MAAM,EAAE,WAAW,CAAC,CAAC;gBACpC,GAAI,UAAU,MAAM,EAAE,WAAW,CAAC,CAAC;YACrC;QACF;IACF;AACF"}},
    {"offset": {"line": 324, "column": 0}, "map": {"version":3,"sources":["file:///Users/murakamimaxi/Desktop/%E3%82%B3%E3%83%BC%E3%83%88%E3%82%99/sns_analyst/utils/supabase/server.ts"],"sourcesContent":["import type { SupabaseClient } from '@supabase/supabase-js';\n\nimport type { Database } from '../../types/database';\nimport {\n  createSupabaseClientWithConfig,\n  getSupabaseServiceRoleKey,\n} from './config';\n\nexport type ServerSupabaseClient = SupabaseClient<Database>;\n\nexport const createServerSupabaseClient = (): ServerSupabaseClient =>\n  createSupabaseClientWithConfig(getSupabaseServiceRoleKey(), {\n    auth: {\n      persistSession: false,\n      autoRefreshToken: false,\n      detectSessionInUrl: false,\n    },\n  });\n"],"names":[],"mappings":";;;;AAGA;;AAOO,MAAM,6BAA6B,IACxC,IAAA,6JAA8B,EAAC,IAAA,wJAAyB,KAAI;QAC1D,MAAM;YACJ,gBAAgB;YAChB,kBAAkB;YAClB,oBAAoB;QACtB;IACF"}},
    {"offset": {"line": 341, "column": 0}, "map": {"version":3,"sources":["file:///Users/murakamimaxi/Desktop/%E3%82%B3%E3%83%BC%E3%83%88%E3%82%99/sns_analyst/app/analysis/page.tsx"],"sourcesContent":["import { Sparkles } from 'lucide-react';\n\nimport { TagPerformanceChart, type TagPerformanceStat } from '@/components/analysis/tag-performance-chart';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/components/ui/card';\nimport type { AnalysisTags, Database } from '@/types/database';\nimport { createServerSupabaseClient } from '@/utils/supabase/server';\n\ntype VideoRow = Database['public']['Tables']['videos']['Row'];\ntype MetricsRow = Pick<\n  Database['public']['Tables']['metrics_logs']['Row'],\n  'saves' | 'views' | 'fetched_at'\n>;\n\ntype VideoWithMetrics = VideoRow & {\n  metrics_logs: MetricsRow[] | null;\n};\n\ntype TagPath = readonly [keyof AnalysisTags, string];\n\ntype TagCategoryConfig = {\n  id: string;\n  label: string;\n  path: TagPath;\n  optionLabels: Record<string, string>;\n};\n\nconst TAG_CATEGORIES = [\n  {\n    id: 'time_slot',\n    label: '投稿時間帯',\n    path: ['basic', 'time_slot'],\n    optionLabels: {\n      early_morning: '早朝 (4-7時)',\n      morning: '朝 (7-11時)',\n      lunch: 'ランチ (11-13時)',\n      afternoon: '午後 (13-17時)',\n      evening: '夕方 (17-20時)',\n      night: '夜 (20時以降)',\n    },\n  },\n  {\n    id: 'sound_type',\n    label: '音源タイプ',\n    path: ['basic', 'sound_type'],\n    optionLabels: {\n      trend: 'トレンド音源',\n      chill: 'チル/BGM',\n      auto_voice: '自動音声',\n      my_voice: '地声ナレーション',\n      asmr: 'ASMR/環境音',\n    },\n  },\n  {\n    id: 'location',\n    label: 'ロケーション',\n    path: ['content', 'location'],\n    optionLabels: {\n      room: '部屋',\n      school: '学校',\n      cafe: 'カフェ',\n      city: '街歩き',\n      trip: '旅先',\n    },\n  },\n  {\n    id: 'action',\n    label: 'シーン/行動',\n    path: ['content', 'action'],\n    optionLabels: {\n      study: '勉強',\n      eat: 'グルメ',\n      play: '遊び',\n      routine: 'ルーティン',\n      talk: 'トーク',\n      shopping: 'ショッピング',\n    },\n  },\n  {\n    id: 'mood',\n    label: '動画の空気感',\n    path: ['content', 'mood'],\n    optionLabels: {\n      happy: 'Happy',\n      calm: 'Calm',\n      tired: 'Tired',\n      emo: 'Emo',\n    },\n  },\n  {\n    id: 'hook_text',\n    label: 'フックのテキスト',\n    path: ['editing', 'hook_text'],\n    optionLabels: {\n      question: '質問系',\n      conclusion: '結論提示',\n      emotion: 'エモ訴求',\n      none: 'テキストなし',\n    },\n  },\n  {\n    id: 'telop_amount',\n    label: 'テロップ量',\n    path: ['editing', 'telop_amount'],\n    optionLabels: {\n      full: 'フルテロップ',\n      point: 'ポイントのみ',\n      none: 'テロップなし',\n    },\n  },\n  {\n    id: 'target',\n    label: 'ターゲット',\n    path: ['strategy', 'target'],\n    optionLabels: {\n      new: '新規',\n      existing: '既存フォロワー',\n      fan: '濃いファン',\n    },\n  },\n  {\n    id: 'origin',\n    label: '企画の由来',\n    path: ['strategy', 'origin'],\n    optionLabels: {\n      original: 'オリジナル',\n      trend: 'トレンド',\n      copy: '再現/引用',\n    },\n  },\n  {\n    id: 'purpose',\n    label: '狙い',\n    path: ['strategy', 'purpose'],\n    optionLabels: {\n      view: '再生獲得',\n      save: '保存獲得',\n      comment: 'コメント誘発',\n    },\n  },\n] as const satisfies readonly TagCategoryConfig[];\n\ntype TagCategoryId = (typeof TAG_CATEGORIES)[number]['id'];\n\ntype StatsByCategory = Record<TagCategoryId, TagPerformanceStat[]>;\n\ntype WinningTag = TagPerformanceStat & {\n  categoryId: TagCategoryId;\n  categoryLabel: string;\n};\n\nexport default async function AnalysisDashboardPage() {\n  const supabase = createServerSupabaseClient();\n\n  const { data, error } = await supabase\n    .from('videos')\n    .select('id, caption, analysis_tags, metrics_logs(fetched_at, saves, views)')\n    .order('fetched_at', { foreignTable: 'metrics_logs', ascending: false });\n\n  if (error) {\n    throw new Error(error.message);\n  }\n\n  const videos: VideoWithMetrics[] = data ?? [];\n  const statsByCategory = buildTagStats(videos);\n  const winningTags = buildWinningTags(statsByCategory, 6);\n\n  const totalVideos = videos.length;\n  const videosWithMetrics = videos.filter((video) => !!getLatestMetrics(video.metrics_logs)).length;\n  const lastUpdatedAt = getLastUpdatedAt(videos);\n\n  return (\n    <div className=\"mx-auto w-full max-w-6xl space-y-8 px-4 py-10\">\n      <header className=\"space-y-2\">\n        <p className=\"text-sm text-muted-foreground\">タグ別パフォーマンス分析</p>\n        <h1 className=\"text-3xl font-bold\">どのタグが保存を生むのか？</h1>\n        <p className=\"max-w-3xl text-sm text-muted-foreground\">\n          Supabaseに蓄積した動画データを全量集計し、タグごとの平均保存数・再生数を可視化します。\n          ハイパフォーマンスの兆しがある要素を素早く見つけましょう。\n        </p>\n      </header>\n\n      <section className=\"grid gap-6 md:grid-cols-2\">\n        <Card>\n          <CardHeader>\n            <CardTitle>勝ちタグランキング</CardTitle>\n            <CardDescription>平均保存数が高かったタグをカテゴリ横断でピックアップ。</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {winningTags.length ? (\n              <ul className=\"space-y-3\">\n                {winningTags.map((tag, index) => (\n                  <li\n                    key={`${tag.categoryId}-${tag.value}`}\n                    className=\"flex items-center justify-between rounded-md border border-border/70 p-4\"\n                  >\n                    <div>\n                      <p className=\"text-xs font-medium text-muted-foreground\">\n                        #{index + 1} {tag.categoryLabel}\n                      </p>\n                      <p className=\"text-lg font-semibold\">{tag.label}</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        平均保存 {formatMetric(tag.avgSaves)} 件 / 平均再生{' '}\n                        {formatMetric(tag.avgViews)} 件 ・ n={tag.sampleCount}\n                      </p>\n                    </div>\n                    <Badge variant=\"secondary\" className=\"text-sm\">\n                      +{formatMetric(tag.avgSaves)} 保存\n                    </Badge>\n                  </li>\n                ))}\n              </ul>\n            ) : (\n              <p className=\"rounded-md border border-dashed p-6 text-sm text-muted-foreground\">\n                まだ十分な動画データがないため、ランキングを作成できません。\n                まずはInstagram投稿を取り込みタグ付けしてください。\n              </p>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>AIプランナー</CardTitle>\n            <CardDescription>次の撮影テーマが思いつかない時はLLMに相談。</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-5\">\n            <dl className=\"grid grid-cols-2 gap-4 text-sm\">\n              <div>\n                <dt className=\"text-muted-foreground\">タグ付き動画</dt>\n                <dd className=\"text-2xl font-semibold\">{totalVideos}</dd>\n              </div>\n              <div>\n                <dt className=\"text-muted-foreground\">最新同期</dt>\n                <dd className=\"text-base font-medium\">{formatDate(lastUpdatedAt)}</dd>\n              </div>\n              <div>\n                <dt className=\"text-muted-foreground\">metricsあり</dt>\n                <dd className=\"text-2xl font-semibold\">{videosWithMetrics}</dd>\n              </div>\n              <div>\n                <dt className=\"text-muted-foreground\">データカバレッジ</dt>\n                <dd className=\"text-base font-medium\">\n                  {totalVideos ? Math.round((videosWithMetrics / totalVideos) * 100) : 0}%\n                </dd>\n              </div>\n            </dl>\n            <Button className=\"w-full\" variant=\"secondary\">\n              <Sparkles className=\"mr-2 h-4 w-4\" />\n              このデータをもとに次の企画を提案して\n            </Button>\n          </CardContent>\n        </Card>\n      </section>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>タグ × 保存数の相関</CardTitle>\n          <CardDescription>\n            プルダウンでカテゴリを切り替えて、各タグが平均保存数にどの程度寄与しているかを確認できます。\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <TagPerformanceChart\n            categories={TAG_CATEGORIES.map(({ id, label }) => ({ id, label }))}\n            statsByCategory={statsByCategory}\n          />\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nconst buildTagStats = (videos: VideoWithMetrics[]): StatsByCategory => {\n  const accumulator: Record<\n    TagCategoryId,\n    Record<string, { count: number; saves: number; views: number }>\n  > = TAG_CATEGORIES.reduce(\n    (acc, category) => ({\n      ...acc,\n      [category.id]: {},\n    }),\n    {} as Record<\n      TagCategoryId,\n      Record<string, { count: number; saves: number; views: number }>\n    >,\n  );\n\n  videos.forEach((video) => {\n    if (!video.analysis_tags) {\n      return;\n    }\n\n    const metrics = getLatestMetrics(video.metrics_logs);\n    if (!metrics) {\n      return;\n    }\n\n    TAG_CATEGORIES.forEach((category) => {\n      const value = getTagValue(video.analysis_tags, category.path);\n      if (!value) {\n        return;\n      }\n\n      const bucket =\n        accumulator[category.id][value] ??\n        (accumulator[category.id][value] = {\n          count: 0,\n          saves: 0,\n          views: 0,\n        });\n\n      bucket.count += 1;\n      bucket.saves += metrics.saves;\n      bucket.views += metrics.views;\n    });\n  });\n\n  return TAG_CATEGORIES.reduce(\n    (result, category) => ({\n      ...result,\n      [category.id]: Object.entries(accumulator[category.id])\n        .map(([value, data]) => ({\n          value,\n          label: category.optionLabels[value] ?? value,\n          avgSaves: data.count ? data.saves / data.count : 0,\n          avgViews: data.count ? data.views / data.count : 0,\n          sampleCount: data.count,\n        }))\n        .sort((a, b) => b.avgSaves - a.avgSaves),\n    }),\n    {} as StatsByCategory,\n  );\n};\n\nconst buildWinningTags = (\n  statsByCategory: StatsByCategory,\n  limit: number,\n): WinningTag[] =>\n  TAG_CATEGORIES.flatMap((category) =>\n    (statsByCategory[category.id] ?? []).map((stat) => ({\n      ...stat,\n      categoryId: category.id,\n      categoryLabel: category.label,\n    })),\n  )\n    .filter((entry) => entry.sampleCount > 0)\n    .sort((a, b) => b.avgSaves - a.avgSaves)\n    .slice(0, limit);\n\nconst getTagValue = (tags: AnalysisTags, path: TagPath): string | null => {\n  const [section, field] = path;\n  const sectionValue = tags[section];\n  if (!sectionValue) {\n    return null;\n  }\n\n  const value = (sectionValue as Record<string, unknown>)[field];\n  return typeof value === 'string' ? value : null;\n};\n\nconst getLatestMetrics = (logs: MetricsRow[] | null): { saves: number; views: number } | null => {\n  if (!logs?.length) {\n    return null;\n  }\n\n  const latest = [...logs].sort((a, b) => {\n    const aTime = a.fetched_at ? new Date(a.fetched_at).getTime() : 0;\n    const bTime = b.fetched_at ? new Date(b.fetched_at).getTime() : 0;\n    return bTime - aTime;\n  })[0];\n\n  if (typeof latest?.saves !== 'number' && typeof latest?.views !== 'number') {\n    return null;\n  }\n\n  return {\n    saves: typeof latest.saves === 'number' ? latest.saves : 0,\n    views: typeof latest.views === 'number' ? latest.views : 0,\n  };\n};\n\nconst getLastUpdatedAt = (videos: VideoWithMetrics[]): Date | null => {\n  let latest: Date | null = null;\n\n  videos.forEach((video) => {\n    video.metrics_logs?.forEach((log) => {\n      if (!log.fetched_at) {\n        return;\n      }\n      const fetchedAt = new Date(log.fetched_at);\n      if (Number.isNaN(fetchedAt.getTime())) {\n        return;\n      }\n      if (!latest || fetchedAt.getTime() > latest.getTime()) {\n        latest = fetchedAt;\n      }\n    });\n  });\n\n  return latest;\n};\n\nconst formatDate = (date: Date | null): string =>\n  date\n    ? date.toLocaleString('ja-JP', {\n        month: 'short',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit',\n      })\n    : '未取得';\n\nconst formatMetric = (value: number): string =>\n  Number.isFinite(value) ? (value % 1 === 0 ? value.toFixed(0) : value.toFixed(1)) : '0';\n"],"names":[],"mappings":"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"}}]
}